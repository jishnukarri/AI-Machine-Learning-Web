<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ocean Cleanup AI</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</head>

<body>
  <div class="container">
    <h1>Ocean Cleanup AI</h1>
    <p>Classify images of ocean debris using AI-powered technology.</p>

    <!-- Slideshow Section -->
    <div class="slideshow">
      <div class="slideshow-image">
        <img id="current-image" src="" alt="Current Image">
        <div class="loading-overlay">Loading...</div>
      </div>
      <div class="slideshow-stats">
        <div class="stat-bar">
          <span>Garbage: <span id="garbage-percentage">0%</span></span>
          <div class="progress-bar">
            <div id="garbage-progress" class="progress-fill"></div>
          </div>
        </div>
        <div class="stat-bar">
          <span>Marine Life: <span id="marine-life-percentage">0%</span></span>
          <div class="progress-bar">
            <div id="marine-life-progress" class="progress-fill"></div>
          </div>
        </div>
      </div>
      <div class="slideshow-controls">
        <button id="prev-btn">❮ Previous</button>
        <button id="next-btn">Next ❯</button>
      </div>
    </div>
  </div>

  <script>
    let model;
    let images = [
      'images/download (2).jpg',
      'images/download.jpg',
      'images/DSC02626-scaled.jpg',
      'images/gilthead-bream-Bristol-Aquarium6.jpg.jpg',
      'images/images (1).jpg',
      'images/images (3).jpg',
      'images/images (5).jpg',
      'images/OceanBotOne.jpeg',
      'images/OceanBotThree.jpg',
      'images/Screenshot 2025-04-04 131722.png',
      'images/sddefault.jpg',
      'images/shorebird-in-polluted-water.jpg',
      'images/Yellowfin-Horse-Mackerel.jpg'
    ];
    let currentIndex = 0;

    // Load the TensorFlow.js model
    async function loadModel() {
      try {
        model = await tf.loadLayersModel('model-new/model.json');
        console.log('Model loaded successfully!');
      } catch (error) {
        console.error('Error loading model:', error);
      }
    }

    // Preload all images to ensure smooth performance
    async function preloadImages() {
      const promises = images.map(src => {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.src = src;
          img.onload = resolve;
          img.onerror = reject;
        });
      });
      try {
        await Promise.all(promises);
        console.log('All images preloaded successfully.');
      } catch (error) {
        console.error('Error preloading images:', error);
      }
    }

    // Display the current image
    function showImage(index) {
      if (index < 0 || index >= images.length) return;

      // Show loading overlay
      document.querySelector('.loading-overlay').style.display = 'flex';

      // Update image source
      const img = document.getElementById('current-image');
      img.src = images[index];
      img.onload = () => {
        document.querySelector('.loading-overlay').style.display = 'none';
        predict(images[index]);
      };
    }

    // Predict the class of the selected image
    async function predict(imageSrc) {
      const img = new Image();
      img.src = imageSrc;
      img.onload = async () => {
        try {
          if (!model) {
            console.error('Model is not loaded yet.');
            return;
          }

          // Preprocess the image
          const tensor = tf.browser.fromPixels(img)
              .resizeNearestNeighbor([224, 224]) // Resize to match model input size
              .toFloat()
              .div(255.0) // Normalize pixel values
              .expandDims(); // Add batch dimension

          // Make predictions
          const predictions = await model.predict(tensor).data();
          const garbagePercent = Math.round(predictions[0] * 100);
          const marineLifePercent = 100 - garbagePercent;

          // Update statistics dynamically
          updateStats(garbagePercent, marineLifePercent);

          console.log('Predictions:', predictions);
        } catch (error) {
          console.error('Error during prediction:', error);
        }
      };
    }

    // Update statistics and progress bars
    function updateStats(garbagePercent, marineLifePercent) {
      document.getElementById('garbage-percentage').innerText = `${garbagePercent}%`;
      document.getElementById('marine-life-percentage').innerText = `${marineLifePercent}%`;

      // Animate progress bars
      document.getElementById('garbage-progress').style.width = `${garbagePercent}%`;
      document.getElementById('marine-life-progress').style.width = `${marineLifePercent}%`;
    }

    // Attach event listeners for navigation
    document.getElementById('prev-btn').addEventListener('click', () => {
      currentIndex = Math.max(currentIndex - 1, 0);
      showImage(currentIndex);
    });

    document.getElementById('next-btn').addEventListener('click', () => {
      currentIndex = Math.min(currentIndex + 1, images.length - 1);
      showImage(currentIndex);
    });

    // Load everything when the page loads
    window.onload = async () => {
      await loadModel();
      await preloadImages();
      showImage(currentIndex);
    };
  </script>
</body>

</html>